# Phase 4: 편집 기능 구현 태스크 (2025-10-07)

**목표:** 기존 빠른 생성 워크플로우를 유지하면서 선택적 편집 기능 추가

---

## ✅ Phase 4.1: 백엔드 인프라 (완료)

- [x] `src/editor/__init__.py` 생성
- [x] `src/editor/config_manager.py` 구현
  - [x] ConfigManager 클래스
  - [x] create_default_config() 메서드
  - [x] save_config() 메서드
  - [x] load_config() 메서드
  - [x] config_exists() 메서드
- [x] `src/editor/video_editor.py` 구현
  - [x] VideoEditor 클래스
  - [x] regenerate_video() 메서드
  - [x] _apply_global_settings() 메서드
  - [x] _extract_clip_data() 메서드
  - [x] create_video_with_config() 메서드
- [x] `web/app.py` 백엔드 API 추가
  - [x] GET /api/video/<video_id>/config
  - [x] POST /api/video/<video_id>/config
  - [x] POST /api/video/<video_id>/regenerate
  - [x] GET /api/download/<video_id>/video_edited
  - [x] 비디오 생성 시 자동 config.json 저장

**진행 상황:** 100% 완료

---

## 🚧 Phase 4.2: 프론트엔드 UI 구현 (진행 중)

### Task 1: editor.html 기본 구조 생성 ✅
**설명:** 편집 페이지 HTML 뼈대 생성 (미리보기, 타임라인, 편집 패널)

**세부 작업:**
- [x] `web/templates/editor.html` 파일 생성
- [x] HTML 기본 구조 작성
  - [x] 헤더 (제목, 뒤로가기 버튼)
  - [x] 비디오 미리보기 섹션
  - [x] 타임라인 섹션 (인트로, 문장 클립, 아웃트로)
  - [x] 편집 패널 (전역 설정, 클립별 설정)
  - [x] 액션 버튼 (저장, 재생성, 취소)
- [x] CSS/JS 파일 링크 추가
- [x] `/editor` 라우트 추가 (web/app.py:222-225)

**완료 조건:** ✅ editor.html 생성 완료, http://localhost:5001/editor 접근 가능

---

### Task 2: editor.css 스타일링 ✅
**설명:** 편집 페이지 레이아웃 및 디자인 구현

**세부 작업:**
- [x] `web/static/css/editor.css` 파일 생성 (470줄)
- [x] 레이아웃 스타일
  - [x] Grid/Flexbox 레이아웃 (타임라인 300px + 편집 패널 1fr)
  - [x] 미리보기 섹션 스타일 (9:16 비디오 비율)
  - [x] 타임라인 스타일 (클립 카드)
  - [x] 편집 패널 스타일
- [x] 컴포넌트 스타일
  - [x] 버튼 스타일 (primary, secondary, tertiary)
  - [x] 입력 필드 스타일 (input, select, range 슬라이더)
  - [x] 클립 카드 스타일 (active, hover 상태)
  - [x] 버튼 그룹 (텍스트 위치 선택)
  - [x] 이미지 미리보기
- [x] 반응형 디자인 (1024px, 768px 브레이크포인트)
- [x] 스크롤바 커스텀 스타일
- [x] 애니메이션 (slideIn)

**완료 조건:** ✅ 편집 페이지가 깔끔하게 표시됨 (http://localhost:5001/editor)

---

### Task 3: editor.js 기본 기능 구현 ✅
**설명:** 설정 로드, 저장, UI 업데이트 로직 구현

**세부 작업:**
- [x] `web/static/js/editor.js` 파일 생성 (450줄)
- [x] 초기화 코드
  - [x] URL에서 video_id 추출 (URLSearchParams)
  - [x] API로 설정 로드 (GET /api/video/<id>/config)
  - [x] UI에 설정 표시 (전역 설정 + 타임라인 클립)
- [x] 전역 설정 이벤트 핸들러
  - [x] 배경음악 선택
  - [x] 배경음악 볼륨 조절 (0-100%)
  - [x] 인트로/아웃트로 길이 선택
- [x] 타임라인 클립 선택
  - [x] 클립 클릭 이벤트
  - [x] 선택된 클립 강조 표시 (.active)
  - [x] 우측 패널에 클립 설정 로드
- [x] 저장 기능
  - [x] [저장] 버튼 클릭 이벤트
  - [x] API로 설정 저장 (POST /api/video/<id>/config)
  - [x] 성공/실패 메시지 표시
- [x] 재생성 기능 (POST /api/video/<id>/regenerate)
- [x] 비디오 재생 컨트롤 (재생/일시정지/시간 표시)

**완료 조건:** ✅ 설정 로드/저장/재생성 가능

---

### Task 4: 클립별 편집 기능 ✅
**설명:** 개별 클립(문장) 편집 기능 구현

**세부 작업:**
- [x] 텍스트 편집
  - [x] 문장 텍스트 입력 필드 (sentence-text)
  - [x] 번역 텍스트 입력 필드 (translation-text)
  - [x] 실시간 UI 업데이트 (input 이벤트)
- [x] 폰트 크기 조절
  - [x] Range 슬라이더 (30-80px)
  - [x] 현재 값 표시 (font-size-value)
- [x] 텍스트 위치 선택
  - [x] 버튼 그룹 (상/중/하)
  - [x] 선택 상태 표시 (.active)
- [x] TTS 음성 선택
  - [x] Dropdown (alloy, nova, shimmer)
  - [x] 첫 번째 음성만 변경 (3회 반복 고정)
- [x] 문장 간격 조절
  - [x] Range 슬라이더 (0~5초)
  - [x] 현재 값 표시 (pause-value)

**완료 조건:** ✅ 클립별 설정 변경 가능 (Task 3에서 함께 구현)

---

### Task 5: 비디오 재생성 기능 ✅
**설명:** 편집된 설정으로 비디오 재생성

**세부 작업:**
- [x] [재생성] 버튼 클릭 이벤트 (onRegenerate)
- [x] 확인 다이얼로그 표시 (confirm)
- [x] API 호출 (POST /api/video/<id>/regenerate)
- [x] 진행 상태 표시
  - [x] 상태 메시지 (info: "비디오를 재생성하는 중...")
  - [x] 처리 시간 안내 (3-5분 소요)
- [x] 완료 처리
  - [x] 새 비디오 미리보기 (src 업데이트 + 캐시 방지)
  - [x] 성공 메시지 표시
  - [x] 처리 시간 표시 (processing_time)

**완료 조건:** ✅ 편집된 설정으로 비디오 재생성 가능 (Task 3에서 함께 구현)

---

### Task 6: index.html에 편집 버튼 추가 ✅
**설명:** 기존 비디오 생성 완료 페이지에 [편집하기] 버튼 추가

**세부 작업:**
- [x] `web/templates/index.html` 수정
- [x] 결과 섹션에 [편집하기] 버튼 추가 (line 286-288)
- [x] 버튼 클릭 시 editor.html로 이동
  - [x] video_id를 URL 파라미터로 전달
  - [x] `openEditor()` 함수 추가 (main.js:236-242)
  - [x] 예: `/editor?video_id=20251007_123456`
- [x] CSS 스타일 추가 (기존 btn-secondary 클래스 사용)

**완료 조건:** ✅ 비디오 생성 후 [편집하기] 버튼이 표시되고 작동함

---

### Task 7: 에러 핸들링 및 UX 개선
**설명:** 사용자 경험 개선 및 예외 상황 처리

**세부 작업:**
- [ ] API 에러 처리
  - [ ] 네트워크 오류
  - [ ] 설정 파일 없음 (404)
  - [ ] 서버 오류 (500)
  - [ ] 사용자 친화적 에러 메시지
- [ ] UX 개선
  - [ ] 변경사항 있을 때 경고 (페이지 나가기 전)
  - [ ] 자동 저장 (5초마다, 선택사항)
  - [ ] 키보드 단축키 (Ctrl+S = 저장)
- [ ] 검증
  - [ ] 빈 문장 체크
  - [ ] 폰트 크기 범위 체크
  - [ ] 볼륨 범위 체크

**완료 조건:** 에러가 발생해도 사용자에게 명확한 메시지 표시

---

## 🧪 Phase 4.3: 통합 테스트

### Task 8: E2E 테스트
**설명:** 전체 워크플로우 테스트

**세부 작업:**
- [ ] 시나리오 1: 빠른 생성 (기존 워크플로우)
  - [ ] 3문장 입력 → 비디오 생성 → 다운로드
  - [ ] 편집 기능 사용 안 함
  - [ ] 기존과 동일하게 작동하는지 확인
- [ ] 시나리오 2: 편집 후 생성
  - [ ] 3문장 입력 → 비디오 생성
  - [ ] [편집하기] 클릭
  - [ ] 배경음악 변경
  - [ ] 폰트 크기 조정
  - [ ] [재생성] 클릭
  - [ ] 편집된 비디오 다운로드
- [ ] 시나리오 3: 설정 저장 및 로드
  - [ ] 편집 페이지에서 설정 변경
  - [ ] [저장] 클릭
  - [ ] 페이지 새로고침
  - [ ] 변경사항 유지되는지 확인

**완료 조건:** 모든 시나리오가 정상 작동

---

### Task 9: 버그 수정 및 문서화
**설명:** 발견된 버그 수정 및 문서 업데이트

**세부 작업:**
- [ ] 버그 수정
  - [ ] 테스트 중 발견된 버그 리스트 작성
  - [ ] 우선순위 지정
  - [ ] 수정 진행
- [ ] 문서 업데이트
  - [ ] README.md 업데이트 (편집 기능 설명)
  - [ ] PHASE4_DESIGN.md 완료 체크
  - [ ] claude.md에 작업 내용 추가
- [ ] 코드 정리
  - [ ] 불필요한 주석 제거
  - [ ] 변수명 일관성 확인
  - [ ] 콘솔 로그 정리

**완료 조건:** 버그 없고 문서화 완료

---

## 📊 진행 상황 요약

| Phase | 태스크 | 상태 | 진행률 |
|-------|--------|------|--------|
| 4.1 | 백엔드 인프라 | ✅ 완료 | 100% |
| 4.2 | 프론트엔드 UI | ✅ 완료 | 100% |
| 4.3 | 통합 테스트 | ⏳ 대기 | 0% |

**전체 진행률:** 67%

---

## 🎯 다음 액션

**Task 7:** 에러 핸들링 및 UX 개선 (선택사항)

사용자 컨펌 후 진행합니다.
